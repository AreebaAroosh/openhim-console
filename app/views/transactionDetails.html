<div class="page-content">
  <div class="row">
    <!-- include the sidebar -->
    <div ng-include="'views/sidebar.html'"></div>
    <div class="col-md-10">

      <div class="content-box-large">
        <div class="panel-heading">
          <div class="panel-title" style="float: inherit">
            <h2>
              <i ng-if="transactionDetails.childIDs.length == 0" class="glyphicon glyphicon-tasks"></i>
              <i ng-if="transactionDetails.childIDs.length > 0" class="glyphicon glyphicon-repeat"></i>
              &nbsp;Transaction #{{transactionDetails._id}}</h2>
          </div>
        </div>

        <!-- Transaction Alerts -->
        <alert ng-repeat="alert in alerts.server" type="alert.type">{{alert.msg}}</alert>
        <!-- Server Alerts -->

        <div class="panel-body" ng-show="transactionDetails">
          <!-- div to hold any child transactions if any -->
          <div class="rerunTransactionsDiv">
            <button ng-if="transactionDetails.parentID" class="btn btn-primary" ng-click='viewTransactionDetails("/transactions/" + transactionDetails.parentID)'>View Original Transaction</button>
            <button ng-if="childTransactions.length >= 1" class="btn btn-primary" data-toggle="collapse" data-target="#no-more-tables">View all rerun transactions</button>            
          </div>

          <div class="buttons-container">
            <button class="btn btn-primary" ng-if="rerunAllowed" ng-click="confirmRerunTransactions();">Re-run Transaction</button>
          </div>

          <div id="no-more-tables" class="collapse" style="width: 100%; clear: both;">
            <!-- Table with all the transaction logs -->
            <table class="table table-striped rerunTransactionsTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>HTTP Method</th>
                  <th>Path</th>
                  <th>Request Params</th>
                  <th>Status</th>
                  <th>Received Time</th>
                </tr>
              </thead>
              <tbody>
                <tr class="table-list" ng-repeat="childTransaction in childTransactions" ng-click='viewTransactionDetails("/transactions/" + childTransaction._id, $event)'>
                  <td data-title="# {{ $index +1 }}" class="responsiveTransactionIndexCheckbox"><span>{{ $index +1 }}</span></td>
                  <td data-title="HTTP Method">{{ childTransaction.request.method }}</td>
                  <td data-title="Path">{{ childTransaction.request.path }}</td>
                  <td data-title="Request Params">{{ childTransaction.request.querystring }}</td>
                  <td data-title="Status">{{ childTransaction.status }}</td>
                  <td data-title="Received Time">{{ childTransaction.request.timestamp | date:'yyyy-MM-dd HH:mm:ss Z' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="transaction-detail-container">
            <div class="data-group">
              <label>ID: </label>
              <div class="data-value">{{transactionDetails._id}}</div>
            </div>
            <div class="data-group">
              <label>Status: </label>
              <div class="data-value">{{transactionDetails.status}}</div>
            </div>
            <div class="data-group">
              <label>Channel: </label>
              <div class="data-value">{{channel.name}}</div>
            </div>
            <div class="data-group">
              <label>Authorized Client: </label>
              <div class="data-value">{{client.clientID}}</div>
            </div>

            <label>Request: </label>
            <div class="data-group left-indent">
              <label>Path: </label>
              <div class="data-value">{{transactionDetails.request.path}}</div>
            </div>
            <div class="data-group left-indent">
              <label>Request Parameters: </label>
              <div class="data-value">{{transactionDetails.request.querystring}}</div>
            </div>
            <div class="data-group left-indent">
              <label>HTTP Method: </label>
              <div class="data-value">{{transactionDetails.request.method}}</div>
            </div>
            <div class="data-group left-indent">
              <label>Received Timestamp: </label>
              <div class="data-value">{{transactionDetails.request.timestamp | date:'yyyy-MM-dd HH:mm:ss Z'}}</div>
            </div>
            <div class="data-group left-indent" ng-if="transactionDetails.request.body"><label>Body: </label></div>
            <div class="data-group left-indent" ng-if="transactionDetails.request.body">
              <div class="data-value">
                <textarea rows="5">{{transactionDetails.request.body}}</textarea>
                <button style="float: right; margin-top: 10px;" class="btn btn-primary" ng-click="viewBodyDetails('Request', transactionDetails.request.body);">View Full Request Body</button>
              </div>
            </div>

            <label>Response: </label>
            <div class="data-group left-indent">
              <label>Response Status: </label>
              <div class="data-value">{{transactionDetails.response.status}}</div>
            </div>
            <div class="data-group left-indent">
              <label>Received timestamp: </label>
              <div class="data-value">{{transactionDetails.response.timestamp | date:'yyyy-MM-dd HH:mm:ss Z'}}</div>
            </div>
            <div class="data-group left-indent" ng-if="transactionDetails.response.body"><label>Response body:</label></div>
            <div class="data-group left-indent" ng-if="transactionDetails.response.body">
              <div class="data-value">
                <textarea rows="5">{{transactionDetails.response.body}}</textarea>
                <button style="float: right; margin-top: 10px;" class="btn btn-primary" ng-click="viewBodyDetails('Response', transactionDetails.response.body);">View Full Response Body</button>
              </div>
            </div>

            <label ng-show="transactionDetails.routes">Routes: </label>
            <div ng-show="transactionDetails.routes" id="no-more-tables" class="data-group left-indent">
              <div class="data-value">
                <!-- Table with all the Routes logs -->
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Route</th>
                      <th>Method</th>
                      <th>Path</th>                      
                      <th>Request Params</th>
                      <th>Status</th>
                      <th>Received Time</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="table-list" ng-repeat="route in transactionDetails.routes" ng-click='viewAddReqResDetails(route)'>
                      <td data-title="Route">{{ route.name }}</td>
                      <td data-title="Method">{{ route.request.method }}</td>
                      <td data-title="Path">{{ route.request.path }}</td>
                      <td data-title="Request Params">{{ route.request.querystring }}</td>
                      <td data-title="Status">{{ route.response.status }}</td>
                      <td data-title="Received Time">{{ route.response.timestamp | date:'yyyy-MM-dd HH:mm:ss Z' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>


            <label ng-show="transactionDetails.orchestrations">Orchestrations: </label>
            <div ng-show="transactionDetails.orchestrations" id="no-more-tables" class="data-group left-indent">
              <div class="data-value">
                <!-- Table with all the orchestrations -->
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Method</th>
                      <th>Path</th>                      
                      <th>Request Params</th>
                      <th>Status</th>
                      <th>Received Time</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="table-list" ng-repeat="orchestration in transactionDetails.orchestrations" ng-click='viewAddReqResDetails(orchestration)'>
                      <td data-title="Name">{{ orchestration.name }}</td>
                      <td data-title="Method">{{ orchestration.request.method }}</td>
                      <td data-title="Path">{{ orchestration.request.path }}</td>
                      <td data-title="Request Params">{{ orchestration.request.querystring }}</td>
                      <td data-title="Status">{{ orchestration.response.status }}</td>
                      <td data-title="Received Time">{{ orchestration.response.timestamp | date:'yyyy-MM-dd HH:mm:ss Z' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>


            <label ng-show="transactionDetails.properties">Properties: </label>
            <div class="data-group left-indent">
              <div class="data-value">
                <div class="content-box-large default-labels-box" ng-repeat="(key, property) in transactionDetails.properties">
                  {{key}}: <strong>{{property}}</strong>
                </div>  
              </div>
            </div>

          </div>
          
        </div>
      </div>
    </div>
  </div>
</div>